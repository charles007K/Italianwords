import React, { useState, useEffect } from 'react';
import { ChevronLeft, ChevronRight, RotateCcw, Shuffle, BookOpen } from 'lucide-react';

const FlashcardApp = () => {
  const vocabulary = [
    { italian: "come si chiama", chinese: "您叫什么名字", category: "日常交流" },
    { italian: "mi chiamo", chinese: "我叫", category: "日常交流" },
    { italian: "di dov'è", chinese: "您是哪里人", category: "日常交流" },
    { italian: "voglio mangiare la pasta", chinese: "我想吃意大利面", category: "食物" },
    { italian: "vado al supermercato", chinese: "我去超市", category: "方向交通" },
    { italian: "vado a buttare la spazzatura", chinese: "我去倒垃圾", category: "方向交通" },
    { italian: "vado in biblioteca", chinese: "我去图书馆", category: "方向交通" },
    { italian: "vado a fare la doccia", chinese: "我去洗澡", category: "日常交流" },
    { italian: "aspetta un attimo", chinese: "等一下", category: "日常交流" },
    { italian: "fammi controllare", chinese: "让我检查一下", category: "日常交流" },
    { italian: "quando ceniamo", chinese: "我们什么时候吃晚饭", category: "食物" },
    { italian: "tessera fedeltà", chinese: "会员卡", category: "购物" },
    { italian: "borsa", chinese: "袋子", category: "购物" },
    { italian: "busta di plastica", chinese: "塑料袋", category: "购物" },
    { italian: "chiedere", chinese: "询问", category: "日常交流" },
    { italian: "sconto", chinese: "折扣", category: "购物" },
    { italian: "permesso di soggiorno", chinese: "居留证", category: "证件" },
    { italian: "parcheggio", chinese: "停车场/停车位", category: "方向交通" },
    { italian: "moneta", chinese: "硬币", category: "购物" },
    { italian: "banconota", chinese: "纸币", category: "购物" },
    { italian: "spiccioli", chinese: "零钱", category: "购物" },
    { italian: "comperare", chinese: "买", category: "购物" },
    { italian: "patente", chinese: "驾驶证", category: "证件" },
    { italian: "bianco", chinese: "白色", category: "颜色" },
    { italian: "nero", chinese: "黑色", category: "颜色" },
    { italian: "giallo", chinese: "黄色", category: "颜色" },
    { italian: "rosso", chinese: "红色", category: "颜色" },
    { italian: "rosa", chinese: "粉色", category: "颜色" },
    { italian: "blu", chinese: "蓝色", category: "颜色" },
    { italian: "marrone", chinese: "棕色", category: "颜色" },
    { italian: "grigio", chinese: "灰色", category: "颜色" },
    { italian: "verde", chinese: "绿色", category: "颜色" },
    { italian: "arancione", chinese: "橙色", category: "颜色" },
    { italian: "colorato", chinese: "彩色", category: "颜色" },
    { italian: "argento", chinese: "银白色", category: "颜色" },
    { italian: "guarda", chinese: "看", category: "日常交流" },
    { italian: "capitare", chinese: "碰巧", category: "日常交流" },
    { italian: "dritto", chinese: "直行", category: "方向交通" },
    { italian: "girare a sinistra", chinese: "左转", category: "方向交通" },
    { italian: "girare a destra", chinese: "右转", category: "方向交通" },
    { italian: "pane", chinese: "面包", category: "食物" },
    { italian: "fredda", chinese: "冰凉的", category: "食物" },
    { italian: "ghiaccio", chinese: "冰/冰凉的", category: "食物" },
    { italian: "biscotti", chinese: "饼干(复数)", category: "食物" },
    { italian: "pollo", chinese: "鸡肉", category: "食物" },
    { italian: "manzo", chinese: "牛肉", category: "食物" },
    { italian: "carne di maiale", chinese: "猪肉", category: "食物" },
    { italian: "carne d'agnello", chinese: "羊肉", category: "食物" },
    { italian: "condividere", chinese: "分享", category: "日常交流" },
    { italian: "cocomero", chinese: "西瓜", category: "食物" },
    { italian: "conto", chinese: "小账", category: "购物" },
    { italian: "certo", chinese: "当然", category: "日常交流" },
    { italian: "il prossimo", chinese: "下一个", category: "时间" },
    { italian: "numero", chinese: "号码", category: "其他" },
    { italian: "caldo", chinese: "热的", category: "食物" },
    { italian: "giocare", chinese: "玩", category: "日常交流" },
    { italian: "la colazione", chinese: "早饭", category: "食物" },
    { italian: "la cena", chinese: "晚饭", category: "食物" },
    { italian: "il pranzo", chinese: "午饭", category: "食物" },
    { italian: "crudo", chinese: "生的", category: "食物" },
    { italian: "cotto", chinese: "熟的", category: "食物" },
    { italian: "specchio", chinese: "镜子", category: "其他" },
    { italian: "dimenticavo", chinese: "我忘记了", category: "日常交流" },
    { italian: "mattina", chinese: "上午", category: "时间" },
    { italian: "pomeriggio", chinese: "下午", category: "时间" },
    { italian: "contanti", chinese: "现金", category: "购物" },
    { italian: "pioggia", chinese: "下雨", category: "其他" },
    { italian: "dieci volte", chinese: "十次", category: "时间" },
    { italian: "resto", chinese: "剩余的/找钱", category: "购物" },
    { italian: "gonna", chinese: "裙子", category: "服装" },
    { italian: "pantaloni", chinese: "裤子", category: "服装" },
    { italian: "azienda", chinese: "公司", category: "其他" },
    { italian: "supermercato", chinese: "超市", category: "购物" },
    { italian: "chiuso", chinese: "已关闭的", category: "其他" },
    { italian: "porta", chinese: "门", category: "其他" },
    { italian: "zucchero", chinese: "糖", category: "食物" },
    { italian: "sale", chinese: "盐", category: "食物" },
    { italian: "aceto", chinese: "醋", category: "食物" },
    { italian: "orario", chinese: "时刻表", category: "时间" },
    { italian: "tiroide", chinese: "甲状腺", category: "身体健康" },
    { italian: "gusti", chinese: "口味", category: "食物" },
    { italian: "cono", chinese: "蛋筒", category: "食物" },
    { italian: "benzina", chinese: "汽油", category: "方向交通" },
    { italian: "diesel", chinese: "柴油", category: "方向交通" },
    { italian: "quale", chinese: "哪个", category: "日常交流" },
    { italian: "strumento", chinese: "工具", category: "其他" },
    { italian: "un etto", chinese: "一两=100克", category: "购物" },
    { italian: "va bene così", chinese: "这样可以了", category: "日常交流" },
    { italian: "restituire", chinese: "归还", category: "购物" },
    { italian: "occhiali", chinese: "眼镜", category: "身体健康" },
    { italian: "piccante", chinese: "辣的", category: "食物" },
    { italian: "prenotazione", chinese: "预约(餐厅)", category: "食物" },
    { italian: "appuntamento", chinese: "预约(正式场合)", category: "时间" },
    { italian: "asportare", chinese: "打包", category: "食物" },
    { italian: "adesso", chinese: "现在", category: "时间" },
    { italian: "ti piace", chinese: "你喜欢吗", category: "日常交流" },
    { italian: "tavolo", chinese: "桌子", category: "食物" },
    { italian: "sedia", chinese: "椅子", category: "食物" },
    { italian: "capo", chinese: "老板", category: "其他" },
    { italian: "a piedi", chinese: "步行", category: "方向交通" }
  ];

  const [cards, setCards] = useState(vocabulary);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isFlipped, setIsFlipped] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState('全部');
  const [studiedCards, setStudiedCards] = useState(new Set());

  const categories = ['全部', ...new Set(vocabulary.map(card => card.category))];

  const filteredCards = selectedCategory === '全部' 
    ? cards 
    : cards.filter(card => card.category === selectedCategory);

  const currentCard = filteredCards[currentIndex] || vocabulary[0];

  const nextCard = () => {
    setStudiedCards(prev => new Set([...prev, currentIndex]));
    setCurrentIndex((prev) => (prev + 1) % filteredCards.length);
    setIsFlipped(false);
  };

  const prevCard = () => {
    setCurrentIndex((prev) => (prev - 1 + filteredCards.length) % filteredCards.length);
    setIsFlipped(false);
  };

  const shuffleCards = () => {
    const shuffled = [...filteredCards].sort(() => Math.random() - 0.5);
    setCards(shuffled);
    setCurrentIndex(0);
    setIsFlipped(false);
    setStudiedCards(new Set());
  };

  const resetProgress = () => {
    setCurrentIndex(0);
    setIsFlipped(false);
    setStudiedCards(new Set());
  };

  const getCategoryColor = (category) => {
    const colors = {
      '日常交流': 'bg-blue-100 text-blue-800',
      '购物': 'bg-green-100 text-green-800',
      '方向交通': 'bg-orange-100 text-orange-800',
      '颜色': 'bg-purple-100 text-purple-800',
      '食物': 'bg-red-100 text-red-800',
      '时间': 'bg-yellow-100 text-yellow-800',
      '身体健康': 'bg-pink-100 text-pink-800',
      '证件': 'bg-gray-100 text-gray-800',
      '服装': 'bg-indigo-100 text-indigo-800',
      '其他': 'bg-teal-100 text-teal-800'
    };
    return colors[category] || 'bg-gray-100 text-gray-800';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="max-w-4xl mx-auto">
        {/* 标题 */}
        <div className="text-center mb-6 sm:mb-8 px-4">
          <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 mb-2 flex items-center justify-center gap-2">
            <BookOpen className="w-6 h-6 sm:w-8 sm:h-8" />
            意大利语单词卡片
          </h1>
          <p className="text-sm sm:text-base text-gray-600">点击卡片翻面，使用按钮切换单词</p>
        </div>

        {/* 分类选择器 */}
        <div className="mb-6">
          <div className="flex flex-wrap gap-2 justify-center px-2">
            {categories.map(category => (
              <button
                key={category}
                onClick={() => {
                  setSelectedCategory(category);
                  setCurrentIndex(0);
                  setIsFlipped(false);
                  setStudiedCards(new Set());
                }}
                className={`px-3 py-2 rounded-full text-xs sm:text-sm font-medium transition-all ${
                  selectedCategory === category
                    ? 'bg-blue-500 text-white shadow-lg'
                    : 'bg-white text-gray-700 hover:bg-blue-50 shadow-md'
                }`}
              >
                {category}
              </button>
            ))}
          </div>
        </div>

        {/* 进度指示器 */}
        <div className="mb-4 sm:mb-6 px-4">
          <div className="flex justify-between items-center mb-2">
            <span className="text-xs sm:text-sm text-gray-600">
              进度: {currentIndex + 1} / {filteredCards.length}
            </span>
            <span className="text-xs sm:text-sm text-gray-600">
              已学习: {studiedCards.size} 个
            </span>
          </div>
          <div className="w-full bg-gray-200 rounded-full h-2">
            <div 
              className="bg-blue-500 h-2 rounded-full transition-all duration-300"
              style={{ width: `${((currentIndex + 1) / filteredCards.length) * 100}%` }}
            />
          </div>
        </div>

        {/* 单词卡片 */}
        <div className="flex justify-center mb-6 sm:mb-8 px-4">
          <div 
            className="relative w-full max-w-sm sm:w-96 h-48 sm:h-64 cursor-pointer perspective-1000"
            onClick={() => setIsFlipped(!isFlipped)}
          >
            <div className={`absolute inset-0 w-full h-full transition-transform duration-600 transform-style-preserve-3d ${
              isFlipped ? 'rotate-y-180' : ''
            }`}>
              {/* 正面 - 意大利语 */}
              <div className="absolute inset-0 w-full h-full backface-hidden">
                <div className="bg-white rounded-xl shadow-xl p-4 sm:p-8 h-full flex flex-col justify-center items-center border-l-4 border-blue-500">
                  <div className={`px-2 py-1 rounded-full text-xs font-medium mb-2 sm:mb-4 ${getCategoryColor(currentCard.category)}`}>
                    {currentCard.category}
                  </div>
                  <div className="text-lg sm:text-2xl font-bold text-gray-800 text-center mb-2 sm:mb-4 px-2">
                    {currentCard.italian}
                  </div>
                  <div className="text-xs sm:text-sm text-gray-500 text-center px-2">
                    点击翻面查看中文释义
                  </div>
                </div>
              </div>
              
              {/* 背面 - 中文 */}
              <div className="absolute inset-0 w-full h-full backface-hidden rotate-y-180">
                <div className="bg-white rounded-xl shadow-xl p-4 sm:p-8 h-full flex flex-col justify-center items-center border-l-4 border-green-500">
                  <div className={`px-2 py-1 rounded-full text-xs font-medium mb-2 sm:mb-4 ${getCategoryColor(currentCard.category)}`}>
                    {currentCard.category}
                  </div>
                  <div className="text-sm sm:text-xl text-gray-600 text-center mb-1 sm:mb-2 px-2">
                    {currentCard.italian}
                  </div>
                  <div className="text-lg sm:text-2xl font-bold text-gray-800 text-center mb-2 sm:mb-4 px-2">
                    {currentCard.chinese}
                  </div>
                  <div className="text-xs sm:text-sm text-gray-500 text-center px-2">
                    点击翻面查看意大利语
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* 控制按钮 */}
        <div className="flex justify-center items-center gap-2 sm:gap-4 mb-4 sm:mb-6 px-4">
          <button
            onClick={prevCard}
            className="bg-white hover:bg-gray-50 text-gray-700 px-3 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md transition-all flex items-center gap-1 sm:gap-2 text-sm sm:text-base"
          >
            <ChevronLeft className="w-4 h-4 sm:w-5 sm:h-5" />
            <span className="hidden sm:inline">上一个</span>
            <span className="sm:hidden">上一个</span>
          </button>
          
          <button
            onClick={() => setIsFlipped(!isFlipped)}
            className="bg-blue-500 hover:bg-blue-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md transition-all text-sm sm:text-base"
          >
            翻面
          </button>
          
          <button
            onClick={nextCard}
            className="bg-white hover:bg-gray-50 text-gray-700 px-3 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md transition-all flex items-center gap-1 sm:gap-2 text-sm sm:text-base"
          >
            <span className="hidden sm:inline">下一个</span>
            <span className="sm:hidden">下一个</span>
            <ChevronRight className="w-4 h-4 sm:w-5 sm:h-5" />
          </button>
        </div>

        {/* 功能按钮 */}
        <div className="flex justify-center gap-2 sm:gap-4 px-4">
          <button
            onClick={shuffleCards}
            className="bg-orange-500 hover:bg-orange-600 text-white px-3 sm:px-4 py-2 rounded-lg shadow-md transition-all flex items-center gap-1 sm:gap-2 text-sm"
          >
            <Shuffle className="w-3 h-3 sm:w-4 sm:h-4" />
            <span className="hidden sm:inline">随机排序</span>
            <span className="sm:hidden">随机</span>
          </button>
          
          <button
            onClick={resetProgress}
            className="bg-gray-500 hover:bg-gray-600 text-white px-3 sm:px-4 py-2 rounded-lg shadow-md transition-all flex items-center gap-1 sm:gap-2 text-sm"
          >
            <RotateCcw className="w-3 h-3 sm:w-4 sm:h-4" />
            <span className="hidden sm:inline">重置进度</span>
            <span className="sm:hidden">重置</span>
          </button>
        </div>

        {/* 学习统计 */}
        <div className="mt-6 sm:mt-8 bg-white rounded-lg shadow-md p-4 sm:p-6 mx-2 sm:mx-0">
          <h3 className="text-base sm:text-lg font-semibold text-gray-800 mb-3 sm:mb-4 text-center sm:text-left">学习统计</h3>
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
            <div className="text-center">
              <div className="text-xl sm:text-2xl font-bold text-blue-500">{filteredCards.length}</div>
              <div className="text-xs sm:text-sm text-gray-600">总单词数</div>
            </div>
            <div className="text-center">
              <div className="text-xl sm:text-2xl font-bold text-green-500">{studiedCards.size}</div>
              <div className="text-xs sm:text-sm text-gray-600">已学习</div>
            </div>
            <div className="text-center">
              <div className="text-xl sm:text-2xl font-bold text-orange-500">{filteredCards.length - studiedCards.size}</div>
              <div className="text-xs sm:text-sm text-gray-600">待学习</div>
            </div>
            <div className="text-center">
              <div className="text-xl sm:text-2xl font-bold text-purple-500">
                {Math.round((studiedCards.size / filteredCards.length) * 100)}%
              </div>
              <div className="text-xs sm:text-sm text-gray-600">完成度</div>
            </div>
          </div>
        </div>
      </div>

      <style jsx>{`
        .perspective-1000 {
          perspective: 1000px;
        }
        .transform-style-preserve-3d {
          transform-style: preserve-3d;
        }
        .backface-hidden {
          backface-visibility: hidden;
        }
        .rotate-y-180 {
          transform: rotateY(180deg);
        }
      `}</style>
    </div>
  );
};

export default FlashcardApp;
